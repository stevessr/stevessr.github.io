(()=>{var e={4561:(e,t,o)=>{e.exports=o.p+"assets/A15A.bf51.svg"},3718:(e,t,o)=>{e.exports=o.p+"assets/B15B.fe0c.svg"},7100:(e,t,o)=>{e.exports=o.p+"assets/C15C.8cee.svg"},4898:(e,t,o)=>{e.exports=o.p+"assets/F15F.2e2c.svg"},7979:(e,t,o)=>{e.exports=o.p+"assets/S15S.f7d3.svg"},9244:(e,t,o)=>{e.exports=o.p+"assets/V15FC.c4de.svg"},2668:(e,t,o)=>{e.exports=o.p+"assets/V15V.afc0.svg"},50:(e,t,o)=>{e.exports=o.p+"assets/phi15phi.e585.svg"},4489:(e,t,o)=>{"use strict";e.exports=o.p+"assets/LevelOver0.78f9.ogg"},870:(e,t,o)=>{"use strict";e.exports=o.p+"assets/LevelOver1.83d3.ogg"},393:(e,t,o)=>{"use strict";e.exports=o.p+"assets/LevelOver2.d36e.ogg"},124:(e,t,o)=>{"use strict";e.exports=o.p+"assets/LevelOver3.ad57.ogg"}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{"use strict";var e=o(4489),t=o(870),r=o(393),a=o(124),s=o(50),n=o.n(s),l=o(9244),c=o.n(l),i=o(2668),d=o.n(i),u=o(7979),g=o.n(u),p=o(4561),m=o.n(p),y=o(3718),w=o.n(y),S=o(7100),v=o.n(S),h=o(4898),x=o.n(h);const b={ez:0,hd:1,in:2,at:3};window.addEventListener("DOMContentLoaded",(()=>{const o=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext);document.querySelector("div#avatarBar").addEventListener("click",(e=>{var t=e.target;null==t.classList.toString().match("avatarBar")&&(t=e.target.parentElement),t.classList.toString().match("expand")?t.classList.remove("expand"):t.classList.add("expand")})),null!=window.localStorage.getItem("playerName")&&(console.log("Setting player name: ",window.localStorage.getItem("playerName")),document.querySelector("div#avatarBar").setAttribute("data-name",window.localStorage.getItem("playerName"))),null!=window.localStorage.getItem("playerAvatar")&&(console.log("Setting player avatar: ",window.localStorage.getItem("playerAvatar")),document.querySelector("div#avatarBar").children[0].setAttribute("style",'--avatar: url("'+window.localStorage.getItem("playerAvatar")+'");'));const s=sessionStorage.getItem("play"),l=sessionStorage.getItem("level"),i=b[l],u=parseInt(sessionStorage.getItem("score")),p=sessionStorage.getItem("maxCombo"),y=sessionStorage.getItem("perfect"),S=sessionStorage.getItem("good"),h=sessionStorage.getItem("early"),I=sessionStorage.getItem("bad"),f=sessionStorage.getItem("miss"),L=sessionStorage.getItem("mode");switch(L){case"normal":"true"==sessionStorage.getItem("isNewBest")&&(document.querySelector("#scrollFrame").classList.add("newBest"),document.querySelector("#scrollFrame").setAttribute("data-nb","NEW BEST "+sessionStorage.getItem("prevBest").toString().padStart(7,"0")+" +"+(u-sessionStorage.getItem("prevBest"))));break;case"auto":document.querySelector("#scrollFrame").classList.add("auto");break;case"hyper":document.querySelector("#scrollFrame").classList.add("hyper")}sessionStorage.clear();const R=Math.round((parseInt(y)+.65*parseInt(S))/(parseInt(y)+parseInt(S)+parseInt(I)+parseInt(f)+0)*1e4)/100,B=S-h;var q,A;0==u&&(console.log("No grade"),q="",A=""),u<699999&&0!=u&&(console.log("Grade: False"),q="F15F",A=x()),7e5<=u&&u<=819999&&(console.log("Grade:C"),q="C15C",A=v()),82e4<=u&&u<=879999&&(console.log("Grade:B"),q="B15B",A=w()),88e4<=u&&u<=919999&&(console.log("Grade:A"),q="A15A",A=m()),92e4<=u&&u<=959999&&(console.log("Grade:S"),q="S15S",A=g()),96e4<=u&&u<=999999&&(console.log("Grade:V"),q="V15V",A=d()),0==I&&0==f&&(console.log("Grade: V wih Full Combo"),q="V15FC",A=c()),1e6<=u&&(console.log("Grade:Phi"),q="phi15phi",A=n()),fetch("https://charts.phicommunity.com.cn/"+s+"/meta.json").then((e=>e.json())).then((n=>{window.window.playResult={score:u,grade:q,gradeURL:A,play:s,playLevel:i,songInfo:n,maxCombo:p,accuracy:R,perFect:y,good:S,bad:I,miss:f,early:h,late:B,playLevelString:l,mode:L},console.log(window.playResult);let c=e;switch(i){case 0:c=e;break;case 1:c=t;break;case 2:c=r;break;case 3:c=a}const d=new AbortController;var g,m;fetch(c,d.signal).then((e=>e.arrayBuffer())).then((e=>{o.decodeAudioData(e,(function(e){var t=o.createBufferSource();t.buffer=e,t.loop=!0,t.connect(o.destination),t.start(0)}))})),document.getElementById("retryBtn").addEventListener("click",(()=>{null==o?d.abort():o.close(),location.href="../whilePlaying/index.html?play="+s+"&l="+l})),document.getElementById("backInResultBtn").addEventListener("click",(()=>{null==o?d.abort():o.close(),location.href="../songSelect/index.html"})),document.body.setAttribute("style",`--background:url(${encodeURI("https://charts.phicommunity.com.cn/"+window.playResult.play+"/"+window.playResult.songInfo.illustration)});`),document.querySelector("#songImg").setAttribute("src",encodeURI("https://charts.phicommunity.com.cn/"+s+"/"+window.playResult.songInfo.illustration)),document.querySelector("#score").innerText=u.toString().padStart(7,"0"),fetch(A).then((e=>e.blob())).then((e=>{document.querySelector("#gradeImage").src=URL.createObjectURL(e)})),document.querySelector("#maxCombo").innerText=p,document.querySelector("#accuracy").innerText=R+"%",document.querySelector("#perfect").innerText=y,document.querySelector("#good").innerText=S,document.querySelector("#bad").innerText=I,document.querySelector("#miss").innerText=f,document.querySelector("#early").innerText=h,document.querySelector("#late").innerText=B,document.querySelector("div.songName#songName").innerText=window.playResult.songInfo.name,document.querySelector("div.levelString#levelString").innerText=window.playResult.playLevelString.toUpperCase()+" Lv."+Math.floor(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0),g=window.playResult.accuracy>=70?(Math.pow((window.playResult.accuracy-55)/45,2)*(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0)).toFixed(2):0,window.playResult.score<88e4&&(m=0),document.querySelector("#rks").innerText=g,console.log("ΔRKS:",g),console.log("ΔData(KB):",m)})).catch((()=>{alert("歌曲信息获取失败！")}))}))})()})();